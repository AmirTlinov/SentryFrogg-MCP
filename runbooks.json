{
  "k8s.render": {
    "description": "Render kustomize overlay via kubectl kustomize.",
    "tags": ["k8s", "gitops"],
    "inputs": ["overlay", "kubeconfig", "sops_age_key_file"],
    "steps": [
      {
        "id": "render",
        "tool": "mcp_local",
        "args": {
          "action": "exec",
          "command": "kubectl",
          "args": ["kustomize", "{{ input.overlay }}"],
          "env": {
            "KUBECONFIG": "{{ input.kubeconfig }}",
            "SOPS_AGE_KEY_FILE": "{{ ?input.sops_age_key_file }}"
          },
          "inline": true
        }
      }
    ]
  },
  "k8s.diff": {
    "description": "Render and diff against cluster.",
    "tags": ["k8s", "gitops", "read"],
    "inputs": ["overlay", "kubeconfig", "sops_age_key_file"],
    "steps": [
      {
        "id": "render",
        "tool": "mcp_local",
        "args": {
          "action": "exec",
          "command": "kubectl",
          "args": ["kustomize", "{{ input.overlay }}"],
          "env": {
            "KUBECONFIG": "{{ input.kubeconfig }}",
            "SOPS_AGE_KEY_FILE": "{{ ?input.sops_age_key_file }}"
          },
          "inline": true
        }
      },
      {
        "id": "diff",
        "tool": "mcp_local",
        "args": {
          "action": "exec",
          "command": "kubectl",
          "args": ["diff", "-f", "-"],
          "stdin": "{{ steps.render.stdout }}",
          "env": {
            "KUBECONFIG": "{{ input.kubeconfig }}"
          },
          "inline": true
        }
      }
    ]
  },
  "k8s.apply": {
    "description": "Render and apply to cluster.",
    "tags": ["k8s", "gitops", "write"],
    "inputs": ["overlay", "kubeconfig", "sops_age_key_file"],
    "steps": [
      {
        "id": "render",
        "tool": "mcp_local",
        "args": {
          "action": "exec",
          "command": "kubectl",
          "args": ["kustomize", "{{ input.overlay }}"],
          "env": {
            "KUBECONFIG": "{{ input.kubeconfig }}",
            "SOPS_AGE_KEY_FILE": "{{ ?input.sops_age_key_file }}"
          },
          "inline": true
        }
      },
      {
        "id": "apply",
        "tool": "mcp_local",
        "args": {
          "action": "exec",
          "command": "kubectl",
          "args": ["apply", "-f", "-"],
          "stdin": "{{ steps.render.stdout }}",
          "env": {
            "KUBECONFIG": "{{ input.kubeconfig }}"
          },
          "inline": true
        }
      }
    ]
  },
  "repo.snapshot": {
    "description": "Fast repository context: root, branch, status, recent commits, diffstat.",
    "tags": ["repo", "git", "read"],
    "inputs": ["repo_path"],
    "steps": [
      {
        "id": "root",
        "tool": "mcp_local",
        "args": {
          "action": "exec",
          "command": "git",
          "args": ["rev-parse", "--show-toplevel"],
          "cwd": "{{ ?input.repo_path }}",
          "inline": true
        }
      },
      {
        "id": "branch",
        "tool": "mcp_local",
        "args": {
          "action": "exec",
          "command": "git",
          "args": ["branch", "--show-current"],
          "cwd": "{{ steps.root.stdout }}",
          "inline": true
        }
      },
      {
        "id": "status",
        "tool": "mcp_local",
        "args": {
          "action": "exec",
          "command": "git",
          "args": ["status", "--short"],
          "cwd": "{{ steps.root.stdout }}",
          "inline": true
        }
      },
      {
        "id": "diffstat",
        "tool": "mcp_local",
        "args": {
          "action": "exec",
          "command": "git",
          "args": ["diff", "--stat"],
          "cwd": "{{ steps.root.stdout }}",
          "inline": true
        }
      },
      {
        "id": "recent",
        "tool": "mcp_local",
        "args": {
          "action": "exec",
          "command": "git",
          "args": ["log", "-5", "--oneline"],
          "cwd": "{{ steps.root.stdout }}",
          "inline": true
        }
      }
    ]
  },
  "ssh.system_info": {
    "description": "Remote system snapshot via SSH.",
    "tags": ["ssh", "read"],
    "inputs": ["project_name", "target_name"],
    "steps": [
      {
        "id": "info",
        "tool": "mcp_ssh_manager",
        "args": {
          "action": "system_info",
          "project": "{{ input.project_name }}",
          "target": "{{ input.target_name }}"
        }
      }
    ]
  },
  "ssh.health": {
    "description": "Quick SSH reachability check.",
    "tags": ["ssh", "read"],
    "inputs": ["project_name", "target_name"],
    "steps": [
      {
        "id": "check",
        "tool": "mcp_ssh_manager",
        "args": {
          "action": "check_host",
          "project": "{{ input.project_name }}",
          "target": "{{ input.target_name }}"
        }
      }
    ]
  },
  "api.check": {
    "description": "API health check.",
    "tags": ["api", "read"],
    "inputs": ["project_name", "target_name", "base_url", "path"],
    "steps": [
      {
        "id": "check",
        "tool": "mcp_api_client",
        "args": {
          "action": "check",
          "project": "{{ input.project_name }}",
          "target": "{{ input.target_name }}",
          "base_url": "{{ ?input.base_url }}",
          "path": "{{ input.path }}"
        }
      }
    ]
  }
}
